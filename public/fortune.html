<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/main.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <title>今日の運勢 - 運勢トラッカー</title>
</head>
<body>
    <!-- Background Animation -->
    <div class="bg-animation">
        <div class="bg-gradient"></div>
        <div class="floating-shapes">
            <span></span><span></span><span></span>
            <span></span><span></span><span></span>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Main Content -->
    <div class="app-container">
        <div class="fade-in">
            <!-- Header -->
            <header class="app-header">
                <div class="fortune-icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"/>
                        <path d="M12 2a10 10 0 0 1 0 20"/>
                        <path d="M12 2v10l7 4"/>
                    </svg>
                </div>
                <h1 class="app-title" data-i18n="fortune.title">今日の運勢</h1>
                <p class="app-subtitle" data-i18n="fortune.subtitle">あなたの運勢を占います</p>
            </header>

            <!-- Fortune Form -->
            <div id="fortuneForm" class="glass-card slide-up">
                <div class="fortune-intro">
                    <p class="fortune-intro-text">現在の運ポイントに基づいて運勢を占います</p>
                    <div class="current-points">
                        <span class="points-label" data-i18n="home.currentPoints">現在の運ポイント</span>
                        <span class="points-value" id="currentPoints">0pt</span>
                    </div>
                </div>

                <button onclick="tellFortune()" class="btn btn-primary btn-lg btn-block mt-xl">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 20px; height: 20px;">
                        <circle cx="12" cy="12" r="10"/>
                        <path d="M12 2a10 10 0 0 1 0 20"/>
                        <path d="M12 2v10l7 4"/>
                    </svg>
                    <span data-i18n="home.viewFortune">今日の運勢を見る</span>
                </button>
            </div>

            <!-- Fortune Result (hidden initially) -->
            <div id="fortuneResult" class="glass-card fortune-result slide-up" style="display: none;">
                <div class="result-header">
                    <span class="result-label" data-i18n="fortune.resultLabel">今日は</span>
                </div>
                <div class="fortune-rank" id="fortuneRank"></div>
                <div class="fortune-message" id="fortuneMessage"></div>

                <!-- Recommendation -->
                <div class="fortune-recommendation" id="fortuneRecommendation">
                    <div class="recommendation-label" data-i18n="fortune.recommendation">今日おすすめの行動</div>
                    <div class="recommendation-text" id="recommendationText"></div>
                </div>

                <div class="fortune-weights">
                    <div class="fortune-weight">
                        <div class="fortune-weight-label">
                            <span data-i18n="fortune.effortMultiplier">努力倍率</span>
                            <span class="tooltip">
                                <svg class="tooltip-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="10"/>
                                    <path d="M12 16v-4M12 8h.01"/>
                                </svg>
                                <span class="tooltip-content">努力記録時のポイント獲得率</span>
                            </span>
                        </div>
                        <div class="fortune-weight-value" id="effortWeight">x1.0</div>
                    </div>
                    <div class="fortune-weight">
                        <div class="fortune-weight-label">
                            <span data-i18n="fortune.luckMultiplier">運倍率</span>
                            <span class="tooltip">
                                <svg class="tooltip-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="10"/>
                                    <path d="M12 16v-4M12 8h.01"/>
                                </svg>
                                <span class="tooltip-content">良いことが起きやすさの目安</span>
                            </span>
                        </div>
                        <div class="fortune-weight-value" id="luckWeight">x1.0</div>
                    </div>
                </div>

                <div class="btn-group mt-xl">
                    <button onclick="copyResult()" class="btn btn-outline">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 18px; height: 18px;">
                            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
                            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
                        </svg>
                        <span data-i18n="fortune.copyResult">結果をコピー</span>
                    </button>
                    <a href="create.html" class="btn btn-primary btn-lg" style="flex: 1;">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 20px; height: 20px;">
                            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                        </svg>
                        <span data-i18n="home.recordEffort">努力を記録</span>
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Bottom Navigation -->
    <nav class="bottom-nav">
        <a href="index.html" class="nav-item">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                <polyline points="9 22 9 12 15 12 15 22"/>
            </svg>
            <span data-i18n="nav.home">ホーム</span>
        </a>
        <a href="create.html" class="nav-item">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="12" y1="5" x2="12" y2="19"/>
                <line x1="5" y1="12" x2="19" y2="12"/>
            </svg>
            <span data-i18n="nav.record">記録</span>
        </a>
        <a href="fortune.html" class="nav-item active">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"/>
                <path d="M12 16v-4M12 8h.01"/>
            </svg>
            <span data-i18n="nav.fortune">運勢</span>
        </a>
        <a href="graph.html" class="nav-item">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="18" y1="20" x2="18" y2="10"/>
                <line x1="12" y1="20" x2="12" y2="4"/>
                <line x1="6" y1="20" x2="6" y2="14"/>
            </svg>
            <span data-i18n="nav.graph">推移</span>
        </a>
        <a href="history.html" class="nav-item">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"/>
                <polyline points="12 6 12 12 16 14"/>
            </svg>
            <span data-i18n="nav.history">履歴</span>
        </a>
    </nav>

    <style>
        .fortune-icon {
            width: 80px;
            height: 80px;
            margin: 0 auto var(--space-md);
            border-radius: 50%;
            background: var(--gradient-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 8px 32px rgba(102, 126, 234, 0.4);
        }

        .fortune-icon svg {
            width: 44px;
            height: 44px;
        }

        .fortune-intro {
            text-align: center;
        }

        .fortune-intro-text {
            opacity: 0.8;
            margin-bottom: var(--space-lg);
        }

        .current-points {
            background: rgba(255, 255, 255, 0.1);
            padding: var(--space-lg);
            border-radius: var(--radius-md);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .points-label {
            opacity: 0.7;
        }

        .points-value {
            font-size: var(--font-size-2xl);
            font-weight: 700;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* Result Styles */
        .result-header {
            text-align: center;
            margin-bottom: var(--space-md);
        }

        .result-label {
            display: inline-block;
            padding: var(--space-xs) var(--space-md);
            background: rgba(255, 255, 255, 0.2);
            border-radius: var(--radius-full);
            font-size: var(--font-size-sm);
            font-weight: 500;
        }

        .fortune-rank {
            font-size: var(--font-size-3xl);
            font-weight: 700;
            text-align: center;
            margin-bottom: var(--space-md);
            background: var(--gradient-warm);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .fortune-message {
            font-size: var(--font-size-lg);
            text-align: center;
            opacity: 0.9;
            margin-bottom: var(--space-lg);
            padding: var(--space-lg);
            background: rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-md);
        }

        .fortune-recommendation {
            text-align: center;
            padding: var(--space-md);
            margin-bottom: var(--space-lg);
            background: rgba(91, 110, 225, 0.15);
            border: 1px solid rgba(91, 110, 225, 0.3);
            border-radius: var(--radius-md);
        }

        .recommendation-label {
            font-size: var(--font-size-xs);
            opacity: 0.7;
            margin-bottom: var(--space-xs);
        }

        .recommendation-text {
            font-weight: 500;
            color: var(--primary-light);
        }

        .fortune-weights {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--space-md);
        }

        .fortune-weight {
            text-align: center;
            padding: var(--space-lg);
            background: rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-md);
        }

        .fortune-weight-label {
            font-size: var(--font-size-sm);
            opacity: 0.8;
            margin-bottom: var(--space-xs);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-xs);
        }

        .fortune-weight-value {
            font-size: var(--font-size-xl);
            font-weight: 700;
            color: var(--accent-light);
        }

        @keyframes fortuneReveal {
            0% {
                transform: scale(0.95);
                opacity: 0;
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        .fortune-result.revealed {
            animation: fortuneReveal 0.4s ease forwards;
        }
    </style>

    <script src="js/storage.js"></script>
    <script src="js/i18n.js"></script>
    <script>
        let currentFortune = null;

        const fortunes = [
            { rank: 1, rankName: "大吉", message: "最高の運気です！新しいことに挑戦してみましょう", recommendation: "新しいプロジェクトを始める", effortW: 1.5, luckW: 1.5 },
            { rank: 2, rankName: "吉", message: "良い運気です。努力が実を結ぶ日", recommendation: "大事な決断をする", effortW: 1.3, luckW: 1.3 },
            { rank: 3, rankName: "中吉", message: "まずまずの運気。コツコツ続けましょう", recommendation: "スキルアップの勉強", effortW: 1.2, luckW: 1.1 },
            { rank: 4, rankName: "小吉", message: "穏やかな運気。日常を大切に", recommendation: "身の回りの整理整頓", effortW: 1.1, luckW: 1.0 },
            { rank: 5, rankName: "末吉", message: "慎重に行動すれば運が開けます", recommendation: "計画の見直し", effortW: 1.0, luckW: 0.9 },
            { rank: 6, rankName: "凶", message: "今日は整える日。無理せず", recommendation: "休息とリラックス", effortW: 0.9, luckW: 0.8 },
            { rank: 7, rankName: "小凶", message: "焦らず一歩ずつ進みましょう", recommendation: "読書や内省の時間", effortW: 0.8, luckW: 0.7 },
            { rank: 8, rankName: "大凶", message: "休息と準備の日。次に備えて", recommendation: "早めに休む", effortW: 0.7, luckW: 0.6 }
        ];

        // Display current points
        document.addEventListener('DOMContentLoaded', async function() {
            await I18n.init('ja');

            const totalPoints = FortuneTeller.getTotalPoints();
            document.getElementById('currentPoints').textContent = totalPoints + 'pt';
        });

        function tellFortune() {
            const totalPoints = FortuneTeller.getTotalPoints();

            // Calculate fortune rank based on points (with some randomness)
            let baseRank;
            if (totalPoints >= 20) {
                baseRank = Math.floor(Math.random() * 3); // 0-2 -> rank 1-3
            } else if (totalPoints >= 10) {
                baseRank = Math.floor(Math.random() * 3) + 2; // 2-4 -> rank 3-5
            } else if (totalPoints >= 0) {
                baseRank = Math.floor(Math.random() * 3) + 4; // 4-6 -> rank 5-7
            } else {
                baseRank = Math.floor(Math.random() * 3) + 5; // 5-7 -> rank 6-8
            }

            currentFortune = fortunes[baseRank];

            // Hide form, show result
            document.getElementById('fortuneForm').style.display = 'none';
            const resultDiv = document.getElementById('fortuneResult');
            resultDiv.style.display = 'block';
            resultDiv.classList.add('revealed');

            // Display result
            document.getElementById('fortuneRank').textContent = currentFortune.rankName;
            document.getElementById('fortuneMessage').textContent = currentFortune.message;
            document.getElementById('recommendationText').textContent = currentFortune.recommendation;
            document.getElementById('effortWeight').textContent = `x${currentFortune.effortW}`;
            document.getElementById('luckWeight').textContent = `x${currentFortune.luckW}`;
        }

        function copyResult() {
            if (!currentFortune) return;

            const text = `【今日の運勢】${currentFortune.rankName}
${currentFortune.message}
おすすめ: ${currentFortune.recommendation}
努力倍率: x${currentFortune.effortW} / 運倍率: x${currentFortune.luckW}
#運勢トラッカー`;

            navigator.clipboard.writeText(text).then(() => {
                showToast(I18n.t('fortune.copied'));
            });
        }

        function showToast(message, type = 'success') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `
                <svg class="toast-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/>
                </svg>
                <span>${message}</span>
            `;
            container.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }
    </script>
</body>
</html>
